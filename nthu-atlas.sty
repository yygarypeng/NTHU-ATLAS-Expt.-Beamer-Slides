% original template site: https://www.overleaf.com/latex/templates/polyu-beamer-slides/pyhhgmgmvzhg
% with LICENSE: Creative Commons CC BY 4.0
% This fork template is modified from the template created by Rui Song.

% =================================COPY RIGHT=================================
% Author   : Y.Y. Gary Peng
% License  : Creative Commons CC BY 4.0
% E-mail   : yygarypeng@gapp.nthu.edu.tw
% Institute: Dept. of Physics, Natl. Tsing Hua University, Hsinchu, Taiwan.
% Date     : Oct. 21, 2023
% ============================================================================

% NEED TO USE pdfLATEX
\ProvidesPackage{nthu_atlas}[2023/10/21 Beamer Theme for NTHU ATLAS Expt Report editing from PolyU by Crumble Jon (2023/04/29).]

% ============================================================================
% Packages
% ============================================================================

\RequirePackage{tikz}
\RequirePackage{xcolor}
\RequirePackage{amsmath}
\RequirePackage{amsfonts}
\RequirePackage{verbatim}
\RequirePackage{hyperref}
\RequirePackage{listings}
\RequirePackage{transparent} % need to implement with pdflatex!

% ============================================================================
% Color Accents
% ============================================================================

\definecolor{nthupurple}{HTML}{7F1084}
\definecolor{nthupurple2}{HTML}{660C6A}
\definecolor{nthugrey}{HTML}{B5B5B6}
\definecolor{ATLASblue}{HTML}{0b80c3}

\setbeamercolor{title}{fg=white}
\setbeamercolor{author}{fg=white}
\setbeamercolor{date}{fg=white}
\setbeamercolor{head}{bg=nthupurple2}

\setbeamercolor{alerted text}{fg=nthupurple}
\setbeamercolor{normal text}{fg=darkgray,bg=white}
\setbeamercolor{structure}{fg=nthupurple}

\setbeamercolor{jumbo}{bg=nthupurple}
\setbeamercolor{progress bar}{fg=nthupurple,bg=nthugrey}
\setbeamercolor{progress bar progress}{use=progress bar,bg=progress bar.fg}

\hypersetup{
    colorlinks,
    linkcolor=nthupurple,
    anchorcolor=red,
    citecolor=blue!80,
    urlcolor=ATLASblue,
}

%\setbeamercolor{block title}{fg=airforceblue,bg=morelightgray}
%\setbeamercolor{block body}{fg=darkgray,bg=morelightgray}

% ============================================================================
% Fonts
% ============================================================================

\setbeamerfont{author}{size=\small}
\setbeamerfont{date}{size=\footnotesize}
\setbeamerfont{title}{series=\bfseries, size=\huge}
\setbeamerfont{subtitle}{series=\mdseries,size=\normalsize}

\setbeamerfont{frametitle}{series=\bfseries}
\setbeamerfont{framesubtitle}{series=\mdseries}
\setbeamerfont{footline}{size=\scriptsize}
\setbeamerfont{block title}{series=\centering, size=\small}
\setbeamerfont{block body}{size=\scriptsize}

\usefonttheme{professionalfonts}

% ============================================================================
% Basic Settings
% ============================================================================

% cancel navigation symbols
\setbeamertemplate{navigation symbols}{}

% prettier boxes
\setbeamertemplate{blocks}[rounded]

% bullet points
\setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize subitem}{\textemdash}
\setbeamertemplate{itemize subsubitem}{\ensuremath{\circ}}

% paragraph spacing
\setlength{\parskip}{10pt}

% code environment
\lstdefinestyle{mystyle}{
    commentstyle=\color{ATLASblue},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{nthugrey},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\scriptsize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    xleftmargin=10pt,
    xrightmargin=10pt,
}
\lstset{style=mystyle}

% ============================================================================
% Slide Templates
% ============================================================================

% headline for all frames
\setbeamertemplate{headline}{
	\ifnum\theframenumber=1
		% not display the headline for the title page
	\else
		\begin{beamercolorbox}[wd=\paperwidth,ht=40pt]{head}
			\hspace{405pt}\includegraphics[width=21pt]{source/atlas-white.png}
		\end{beamercolorbox}
	\fi
}

% frame title and subtitle
\setbeamertemplate{frametitle}{
    \begin{picture}(0,0)
        \ifx\insertframesubtitle\@empty
            \put(0,27){\usebeamerfont{frametitle}\usebeamercolor[fg]{title}\insertframetitle}
		\else
            \put(0,32){\usebeamerfont{frametitle}\usebeamercolor[fg]{title} \insertframetitle}
            \put(2,19){\usebeamerfont{framesubtitle}\usebeamercolor[fg]{title} \insertframesubtitle }
		\fi
    \end{picture}
}

% title page
\setbeamertemplate{title page}{
    \begin{picture}(0,0)
        \put(-18,72){\includegraphics[width=120pt]{source/logo-name.png}}
        \put(-5,-77){
            \begin{beamercolorbox}[wd=1.1\paperwidth,ht=140pt]{jumbo}
            \end{beamercolorbox}
        }
        \put(303,-36){\transparent{0.3}\includegraphics[width=110pt]{source/nthu-trans.png}}
        \put(175,-135){\includegraphics[width=135pt]{source/tagline.png}}
        \put(105,-143){\includegraphics[width=60pt]{source/cern-logo.png}}
        \put(0,25){
            \begin{minipage}{300pt}
                \vspace{24pt}
                \usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par
                \vspace{10pt}
                \usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle
            \end{minipage}
        }
        \put(0,-45){
            \usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor
        }
        \put(0,-60){
            \usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate
        }
    \end{picture}
}

% blank header page
\makeatletter
    \newenvironment{blank}{
        \setbeamertemplate{headline}{}
    }
\makeatother

% define foot line
\defbeamertemplate{footline}{progress bar with page number}{
    \dimen0=\paperwidth
    \multiply\dimen0 by \insertframenumber
    \divide\dimen0 by \inserttotalframenumber
    \edef\progressbarwidth{\the\dimen0}
    \leavevmode
    \ifnum\theframenumber=1
    \else
        \begin{beamercolorbox}[wd=\paperwidth,ht=1pt,dp=1pt]{progress bar}
            \begin{beamercolorbox}[wd=\progressbarwidth,ht=1pt,dp=1pt]{progress bar progress}
                \put(0.97\paperwidth,3)
                \insertframenumber
            \end{beamercolorbox}
        \end{beamercolorbox}%
    \fi
}
\setbeamertemplate{footline}[progress bar with page number]

% backup frame
\newcommand{\backup}{
    \begingroup
        \setbeamertemplate{headline}{}
        \begin{picture}(0,0)
            \put(-5,-185){
                \begin{beamercolorbox}[wd=1.1\paperwidth,ht=140pt]{jumbo}
                    \put(90,63){
                        \Huge{\textbf{\color{white}{Backup}}}
                    }
                \end{beamercolorbox}
            }
            \put(280,-143){
                \transparent{0.3}\includegraphics[width=110pt]{source/nthu-trans.png}
            } 
	\end{picture}
    \endgroup
}

% last frame
\newcommand{\backmatter}{
    \begingroup
        % wipe out both header and footer.
        \setbeamertemplate{headline}{}
	\setbeamertemplate{footline}{}
	\begin{frame}[c]{}
            \hfill
            \begin{center}
                {\includegraphics[width=0.6\paperwidth]{source/last-frame.png}}
            \end{center}
	\end{frame}
    \endgroup
}

% style of sections and subsections in ToCs
\setbeamertemplate{section in toc}{
    $\blacktriangleright$~\inserttocsection
}
\setbeamertemplate{subsection in toc}{}
\setbeamertemplate{frametitle continuation}{}

% begin of sections
\AtBeginSection[]{
    \begingroup
        \begin{frame}{Contents}{}
            \begin{picture}(0,0)
                \put(250,-225){
                    \transparent{0.1}\includegraphics[width=230pt]{source/nthu-logo.png}
                }
            \end{picture}
            \tableofcontents[currentsection]
        \end{frame}
    \endgroup
}